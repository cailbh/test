<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v3.min.js"></script> -->
  <title>树图 2019/10</title>
  <link rel="stylesheet" href="../css/h3.css">
  <style>
    #force {
      width: 1000px;
      height: 1000px;
    }
  </style>
</head>

<body>
  <div id='force'></div>
  <script>
    const CANVAS_WIDTH = 1000;
    const CANVAS_HEIGHT = 1000;
    var mcolor = ['rgb(255,63,63)', 'rgb(254,217,239)',
      'rgb(255,178,101)', 'rgb(178,255,101)',
      'rgb(83,255,255)', 'rgb(89,196,120)',
      'rgb(83,168,255)', 'rgb(185,122,87)',
      'rgb(168,83,255)', 'rgb(20,230,0)',
      'rgb(230,230,0)', 'rgb(255,73,254)',
      'rgb(112,106,220)', 'rgb(255,255,107)'];
    let k;
    let mNodeList = [];
    let mEdgeList = [];
    let mDxMap = {};
    let mDyMap = {};
    let mNodeMap = {};
    let Com = {}
    // ForceDirected()
    //     data = {
    //         "nodes": [{ "id": "6", "x": 477.90319186195137, "y": 517.9891806212012 }, { "id": "2", "x": 498.18694922815826, "y": 486.22697439290715 }, { "id": "5", "x": 509.9130197163206, "y": 544.3298324546289 }, { "id": "1", "x": 495.0013472929099, "y": 501.34342160569395 }, { "id": "15", "x": 559.8624853307292, "y": 543.5353895065878 }, { "id": "4", "x": 523.2940016723833, "y": 529.7001082061997 }, { "id": "3", "x": 530.4454416533686, "y": 547.7000649485192 }]
    // }
    //     lll 
    // aa 
    // for(i in aa){
    //   if(lll.indexOf(aa[i])==-1)
    //   console.log(aa[i])
    // }
    // console.log(aa,lll)
    d3.json("SSBxy.json", function (a) {
      d3.json("WW_our_sample_times_0_a_0.5_b_0.5_rata_15.json", function (b) {
        // d3.json("WW_ClassicalSample1.json",function(b){
        d3.json("SSB_id_x_y_kde_edges_betweenness.json", function (c) {
          d3.json("WWori_community.json", function (d) {
            d3.csv("WW_Tsne.csv", function (e) {
              console.log(e)
              // drawforce(a,b,c)
              // drawforce3(a,b,c)
              // drawforce2(a,c)
              drawforce4(a, d)
              // drawforce5(a,b,d)
              // drawforce6(a,b,d)
              // drawforce7(e,d)
              // drawforce8(a, b, d)
              // drawforce9(e,b,d)
              // })
            })
          })
        })
      })
    })
    // ForceDirected()
    function ForceDirected() {
      d3.json("WWori_community.json", function (com) {
        d3.json("WW_forceData.json", function (a) {
          Com = com
          console.log(Com)
          //generate nodes and edges
          for (let i = 0; i < a['nodes'].length; i++) {
            mNodeList.push(new Node(a['nodes'][i]));
          }

          for (let i = 0; i < a['edges'].length; i++) {
            let edge = new Edge(a['edges'][i]['source'], a['edges'][i]['target']);
            mEdgeList.push(edge);
          }
          if (mNodeList && mEdgeList) {
            k = Math.sqrt(CANVAS_WIDTH * CANVAS_HEIGHT / mNodeList.length);
          }
          for (let i = 0; i < mNodeList.length; i++) {
            let node = mNodeList[i];
            if (node) {
              mNodeMap[node.id] = node;
            }
          }
          //随机生成坐标. Generate coordinates randomly.
          let initialX, initialY, initialSize = 40.0;
          for (let i in mNodeList) {
            initialX = CANVAS_WIDTH * .5;
            initialY = CANVAS_HEIGHT * .5;
            mNodeList[i].x = initialX + initialSize * (Math.random() - .5);
            mNodeList[i].y = initialY + initialSize * (Math.random() - .5);
          }

          console.log(new Result(mNodeList, mEdgeList));
          //   迭代200次. Iterate 200 times.
          for (let i = 0; i < 1000; i++) {
            calculateRepulsive();
            calculateTraction();
            updateCoordinates();
          }
          da = new Result(mNodeList, mEdgeList);
          drawforce(da)
        }
        )
      }
      )
    }
    function Node(id = null) {
      this.id = id;
      this.x = 22;
      this.y = null;
    }
    function Edge(source = null, target = null) {
      this.source = source;
      this.target = target;
    }

    /**
     * 计算两个Node的斥力产生的单位位移。
     * Calculate the displacement generated by the repulsive force between two nodes.*
     */
    function calculateRepulsive() {
      let ejectFactor = 10;
      let distX, distY, dist;
      for (let i = 0; i < mNodeList.length; i++) {
        mDxMap[mNodeList[i].id] = 0.0;
        mDyMap[mNodeList[i].id] = 0.0;
        for (let j = 0; j < mNodeList.length; j++) {
          if (i !== j) {
            distX = mNodeList[i].x - mNodeList[j].x;
            distY = mNodeList[i].y - mNodeList[j].y;
            dist = Math.sqrt(distX * distX + distY * distY);
          }
          if (dist < 60) {
            ejectFactor = 8;
          }
          if (dist > 0 && dist < 250) {
            let id = mNodeList[i].id;
            mDxMap[id] = mDxMap[id] + distX / dist * k * k / dist * ejectFactor;
            mDyMap[id] = mDyMap[id] + distY / dist * k * k / dist * ejectFactor;
          }
        }
      }
    }

    /**
     * 计算Edge的引力对两端Node产生的引力。
     * Calculate the traction force generated by the edge acted on the two nodes of its two ends.
     */
    function calculateTraction() {
      let condenseFactor = 300;
      let startNode, endNode;
      for (let e = 0; e < mEdgeList.length; e++) {

        let eStartID = mEdgeList[e].source;
        let eEndID = mEdgeList[e].target;
        if (Com[eStartID] == Com[eEndID]) {
          condenseFactor = 1000
          // console.log(111)
        }
        else {
          condenseFactor = 20
        }
        startNode = mNodeMap[eStartID];
        endNode = mNodeMap[eEndID];
        if (!startNode) {
          console.log("Cannot find start node id: " + eStartID + ", please check it out.");
          return;
        }
        if (!endNode) {
          console.log("Cannot find end node id: " + eEndID + ", please check it out.");
          return;
        }

        let distX, distY, dist;
        distX = startNode.x - endNode.x;
        distY = startNode.y - endNode.y;
        dist = Math.sqrt(distX * distX + distY * distY);
        mDxMap[eStartID] = mDxMap[eStartID] - distX * dist / k * condenseFactor;
        mDyMap[eStartID] = mDyMap[eStartID] - distY * dist / k * condenseFactor;
        mDxMap[eEndID] = mDxMap[eEndID] + distX * dist / k * condenseFactor;
        mDyMap[eEndID] = mDyMap[eEndID] + distY * dist / k * condenseFactor;
      }
    }

    /**
     * 更新坐标。
     * update the coordinates.
     */
    function updateCoordinates() {
      let maxt = 4, maxty = 3; //Additional coefficients.
      for (let v = 0; v < mNodeList.length; v++) {
        let node = mNodeList[v];
        let dx = Math.floor(mDxMap[node.id]);
        let dy = Math.floor(mDyMap[node.id]);

        if (dx < -maxt) dx = -maxt;
        if (dx > maxt) dx = maxt;
        if (dy < -maxty) dy = -maxty;
        if (dy > maxty) dy = maxty;

        node.x = node.x + dx >= CANVAS_WIDTH || node.x + dx <= 0 ? node.x - dx : node.x + dx;
        node.y = node.y + dy >= CANVAS_HEIGHT || node.y + dy <= 0 ? node.y - dy : node.y + dy;
      }
    }

    function Result(nodes = null, links = null) {
      this.nodes = nodes;
      this.edges = links;
    }
    sfnum = 2
    function drawforce(data, sam, cc) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // console.log(sam)
      Sa = sam[sfnum]['rate-10'][0]['nodes']
      ja = {}
      for (i in Sa) {
        ja[Sa[i]] = 1
        // ja[Sa[i]['id']]=1
      }
      console.log(ja, sam)
      d = data['nodes']
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      console.log(cc)
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")

      for (jj = 0; jj < sam[sfnum]['rate-10'][0]['edges'].length; jj++) {
        // data['edges']sam['edges']
        x1 = data['nodes'].find(function (x) {
          // return x.id == sam['edges'][jj].source
          //  return x.id ==data['edges'][jj].source
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['x']
        y1 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].source
          // return x.id == data['edges'][jj].source
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['y']
        x2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['x']
        y2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['y']

        g.append("line")
          .attr("x1", scalex(x1 - minx))
          .attr("y1", scaley(y1 - miny))
          .attr("x2", scalex(x2 - minx))
          .attr("y2", scaley(y2 - miny))
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke-opacity", function () {

            // if((ja[sam[sfnum]['rate-10'][0]['edges'][jj][0]]==1)&&(ja[sam[sfnum]['rate-10'][0]['edges'][jj][1]]==1))
            return 1
            // else return 0
          })
          .attr("stroke", function () {

            return "#bbb"
          })
      }
      coutli = []
      for (ii = 0; ii < data["nodes"].length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data['nodes'][ii]['x'] - minx))
          .attr("cy", scaley(data['nodes'][ii]['y'] - miny))
          .attr("r", 3)
          .attr("id", data['nodes'][ii]['id'])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          // .attr("stroke", function () {
          //     return "#bbb"
          // })
          .attr("opacity", function () {
            if (ja[data['nodes'][ii]['id']] == 1)
              return 1
            else return 0
          })
          .attr("fill", function () {
            // if (cc[data['nodes'][ii]['id']]['betweenness'] > 1.024) {
            //   if (ja[data['nodes'][ii]['id']] == 1)
            //     coutli.push(data['nodes'][ii]['id'])
            //   return "red"
            // }
            // else {
            return "#777"
            // }
          });
      }
      // console.log(coutli)

    }
    function drawforce3(data, sam, cc) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // console.log(sam)
      Sa = sam['nodes']
      ja = {}
      for (i in Sa) {
        // ja[Sa[i]]=1
        ja[Sa[i]['id']] = 1
      }
      // console.log(ja,sam)
      d = data['nodes']
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      console.log(cc)
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")

      for (jj = 0; jj < sam['edges'].length; jj++) {
        // data['edges']
        x1 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].source
          //  return x.id ==data['edges'][jj].source
          // return x.id ==sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['x']
        y1 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].source
          // return x.id == data['edges'][jj].source
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['y']
        x2 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['x']
        y2 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['y']

        g.append("line")
          .attr("x1", scalex(x1 - minx))
          .attr("y1", scaley(y1 - miny))
          .attr("x2", scalex(x2 - minx))
          .attr("y2", scaley(y2 - miny))
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke-opacity", function () {

            // if((ja[sam[sfnum]['rate-10'][0]['edges'][jj][0]]==1)&&(ja[sam[sfnum]['rate-10'][0]['edges'][jj][1]]==1))
            return 1
            // else return 0
          })
          .attr("stroke", function () {

            return "#bbb"
          })
      }
      coutli = []
      for (ii = 0; ii < data["nodes"].length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data['nodes'][ii]['x'] - minx))
          .attr("cy", scaley(data['nodes'][ii]['y'] - miny))
          .attr("r", 3)
          .attr("id", data['nodes'][ii]['id'])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          // .attr("stroke", function () {
          //     return "#bbb"
          // })
          .attr("opacity", function () {
            if (ja[data['nodes'][ii]['id']] == 1)
              return 1
            else return 0
          })
          .attr("fill", function () {
            comm = com[data[ii]['id']]
            // if(comm == 2||comm ==11||comm==13||comm==5 ){
            if (comm == 44) {
              return mcolor[0]
            }
            if (comm == 8) {
              return mcolor[6]
            }
            if (comm == 12) {
              return mcolor[10]
            }
            return 'grey'
            // if (cc[data['nodes'][ii]['id']]['betweenness'] > 1.024) {
            // if (ja[data['nodes'][ii]['id']] == 1)
            //   coutli.push(data['nodes'][ii]['id'])
            // idt = data['nodes'][ii]['id']
            // idli = ['1532781', "235219", "4015461"]
            // if (idli.indexOf(idt + "") > -1)
            // return "red"
            // else
            // return "aqua"
            // }
            // else {
            return "#777"
            // }
          });
      }
      console.log(coutli)
    }
    function drawforce2(data, sam) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // Sa =sam[sfnum]['rate-10'][0]['nodes']
      // ja = {}
      // for(i in Sa){
      //   ja[Sa[i]]=1
      //   // ja[Sa[i]['id']]=1
      // }
      // console.log(ja,sam)
      d = data['nodes']
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")

      for (jj = 0; jj < data['edges'].length; jj++) {
        // sam['edges']sam[sfnum]['rate-10'][0]
        x1 = data['nodes'].find(function (x) {
          // return x.id == sam['edges'][jj].source
          return x.id == data['edges'][jj].source
          // return x.id ==sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['x']
        y1 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].source
          return x.id == data['edges'][jj].source
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['y']
        x2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['x']
        y2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['y']
        g.append("line")
          .attr("x1", scalex(x1 - minx))
          .attr("y1", scaley(y1 - miny))
          .attr("x2", scalex(x2 - minx))
          .attr("y2", scaley(y2 - miny))
          .attr("class", "top")
          .attr("stroke-width", 0.2)
          .attr("stroke-opacity", function () {
            // if((ja[data['edges'][jj].source]==1)&&(ja[data['edges'][jj].target]==1))
            return 1
            // else return 0
          })
          .attr("stroke", function () {

            return "#bbb"
          })
      }
      countli = []
      for (ii = 0; ii < data["nodes"].length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data['nodes'][ii]['x'] - minx))
          .attr("cy", scaley(data['nodes'][ii]['y'] - miny))
          .attr("r", 2)
          .attr("id", data['nodes'][ii]['id'])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#bbb"
          })
          .attr("opacity", function () {
            // if(ja[data['nodes'][ii]['id']]==1)
            return 1
            // else return 0
          })
          .attr("fill", function () {
            if (sam[data['nodes'][ii]['id']]['betweenness'] > 1.024) {
              countli.push([scalex(data['nodes'][ii]['x'] - minx), scaley(data['nodes'][ii]['y'] - miny), data['nodes'][ii]['id']])
              return "red"
            }
            else {
              return "#777"
            }

          });
      }
      for (x in countli) {
        g.append("circle")
          .attr("cx", countli[x][0])
          .attr("cy", countli[x][1])
          .attr("r", 3)
          .attr("id", countli[x][2])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#bbb"
          })
          .attr("opacity", function () {
            // if(ja[data['nodes'][ii]['id']]==1)
            return 1
            // else return 0
          })
          .attr("fill", "red")


      }
      console.log(countli)

    }
    function drawforce4(data, com) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // Sa =sam[sfnum]['rate-10'][0]['nodes']
      // ja = {}
      // for(i in Sa){
      //   ja[Sa[i]]=1
      //   // ja[Sa[i]['id']]=1
      // }
      console.log(com)
      d = data['nodes']
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")

      for (jj = 0; jj < data['edges'].length; jj++) {
        // sam['edges']sam[sfnum]['rate-10'][0]
        x1 = data['nodes'].find(function (x) {
          // return x.id == sam['edges'][jj].source
          return x.id == data['edges'][jj].source
          // return x.id ==sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['x']
        y1 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].source
          return x.id == data['edges'][jj].source
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['y']
        x2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['x']
        y2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['y']
        g.append("line")
          .attr("x1", scalex(x1 - minx))
          .attr("y1", scaley(y1 - miny))
          .attr("x2", scalex(x2 - minx))
          .attr("y2", scaley(y2 - miny))
          .attr("class", "top")
          .attr("stroke-width", 0.2)
          .attr("stroke-opacity", function () {
            // if((ja[data['edges'][jj].source]==1)&&(ja[data['edges'][jj].target]==1))
            return 1
            // else return 0
          })
          .attr("stroke", function () {

            return "#bbb"
          })
      }
      countli = []
      for (ii = 0; ii < data["nodes"].length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data['nodes'][ii]['x'] - minx))
          .attr("cy", scaley(data['nodes'][ii]['y'] - miny))
          .attr("r", 2)
          .attr("id", com[data['nodes'][ii]['id']])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#555"
          })
          .attr("opacity", function () {
            // if(ja[data['nodes'][ii]['id']]==1)
            return 1
            // else return 0
          })
          .attr("fill", function () {
            comm = com[data['nodes'][ii]['id']]
            // if(comm == 2||comm ==11||comm==13||comm==5 ){
              if (comm == 44) {
              return mcolor[0]
            }
            if (comm == 8) {
              return mcolor[6]
            }
            if (comm == 12) {
              return mcolor[10]
            }
            if (comm == 6) {
              return mcolor[8]
            }
            if (comm == 39) {
              return mcolor[2]
            }
            if (comm == 42) {
              return mcolor[12]
            } if (comm == 57) {
              return mcolor[4]
            }
            if (comm == 14) {
              return mcolor[5]
            }
            if (comm == 43) {
              return mcolor[7]
            }
            if (comm == 40) {
              return mcolor[11]
            }
            return 'grey'
            // if((comm<40)&&(comm>60)){
            //   return "grey"
            // }
            // return mcolor[com[data['nodes'][ii]['id']]-40]
            // }
            // else return 'grey'

          });
      }
      for (x in countli) {
        g.append("circle")
          .attr("cx", countli[x][0])
          .attr("cy", countli[x][1])
          .attr("r")
          .attr("id", countli[x][2])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          // .attr("stroke", function () {
          //     return "#bbb"
          // })
          .attr("opacity", function () {
            // if(ja[data['nodes'][ii]['id']]==1)
            return 1
            // else return 0
          })
          .attr("fill", "red")


      }
      console.log(countli)

    }
    function drawforce5(data, sam, cc) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // console.log(sam)
      Sa = sam[sfnum]['rate-10'][0]['nodes']
      ja = {}
      for (i in Sa) {
        ja[Sa[i]] = 1
        // ja[Sa[i]['id']]=1
      }
      // console.log(ja,sam)
      d = data['nodes']
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      console.log(cc)
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")

      for (jj = 0; jj < sam[sfnum]['rate-10'][0]['edges'].length; jj++) {
        // data['edges']sam['edges']
        x1 = data['nodes'].find(function (x) {
          // return x.id == sam['edges'][jj].source
          //  return x.id ==data['edges'][jj].source
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['x']
        y1 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].source
          // return x.id == data['edges'][jj].source
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['y']
        x2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['x']
        y2 = data['nodes'].find(function (x) {
          // return x.id ==  sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['y']

        g.append("line")
          .attr("x1", scalex(x1 - minx))
          .attr("y1", scaley(y1 - miny))
          .attr("x2", scalex(x2 - minx))
          .attr("y2", scaley(y2 - miny))
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke-opacity", function () {

            // if((ja[sam[sfnum]['rate-10'][0]['edges'][jj][0]]==1)&&(ja[sam[sfnum]['rate-10'][0]['edges'][jj][1]]==1))
            return 1
            // else return 0
          })
          .attr("stroke", function () {

            return "#bbb"
          })
      }
      for (ii = 0; ii < data["nodes"].length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data['nodes'][ii]['x'] - minx))
          .attr("cy", scaley(data['nodes'][ii]['y'] - miny))
          .attr("r", "3")
          .attr("id", data['nodes'][ii]['id'])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#555"
          })
          .attr("opacity", function () {
            if (ja[data['nodes'][ii]['id']] == 1)
              return 1
            else return 0
          })
          .attr("fill", function () {
            comm = cc[data['nodes'][ii]['id']]
            if (comm == 2 || comm == 11 || comm == 13 || comm == 5) {
              return mcolor[cc[data['nodes'][ii]['id']]]
            }
            else return 'grey'
          });
      }
    }
    function drawforce6(data, sam, cc) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // console.log(sam)
      Sa = sam['nodes']
      ja = {}
      for (i in Sa) {
        // ja[Sa[i]]=1
        ja[Sa[i]['id']] = 1
      }
      // console.log(ja,sam)
      d = data['nodes']
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      console.log(cc)
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")

      for (jj = 0; jj < sam['edges'].length; jj++) {
        // data['edges']
        x1 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].source
          //  return x.id ==data['edges'][jj].source
          // return x.id ==sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['x']
        y1 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].source
          // return x.id == data['edges'][jj].source
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['y']
        x2 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['x']
        y2 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['y']

        g.append("line")
          .attr("x1", scalex(x1 - minx))
          .attr("y1", scaley(y1 - miny))
          .attr("x2", scalex(x2 - minx))
          .attr("y2", scaley(y2 - miny))
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke-opacity", function () {

            // if((ja[sam[sfnum]['rate-10'][0]['edges'][jj][0]]==1)&&(ja[sam[sfnum]['rate-10'][0]['edges'][jj][1]]==1))
            return 1
            // else return 0
          })
          .attr("stroke", function () {

            return "#bbb"
          })
      }
      coutli = []
      for (ii = 0; ii < data["nodes"].length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data['nodes'][ii]['x'] - minx))
          .attr("cy", scaley(data['nodes'][ii]['y'] - miny))
          .attr("r", "3")
          .attr("id", data['nodes'][ii]['id'])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#555"
          })
          .attr("opacity", function () {
            if (ja[data['nodes'][ii]['id']] == 1)
              return 1
            else return 0
          })
          .attr("fill", function () {
            comm = cc[data['nodes'][ii]['id']]
            if (comm == 2 || comm == 11 || comm == 13 || comm == 5) {
              return mcolor[cc[data['nodes'][ii]['id']]]
            }
            else return 'grey'
          });
      }
    }
    function drawforce7(data, com) {
      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // Sa =sam[sfnum]['rate-10'][0]['nodes']
      // ja = {}
      // for(i in com){
      //  if(ja[com[i]]>=0){
      //    ja[com[i]]++
      //  }
      //  else{
      //   //  console.log(0)
      //  ja[com[i]]=0
      //  }
      // }
      // console.log(ja)
      d = data
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")


      for (ii = 0; ii < data.length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data[ii]['x'] - minx))
          .attr("cy", scaley(data[ii]['y'] - miny))
          .attr("r", 3)
          .attr("id", com[data[ii]['id']])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#555"
          })
          .attr("opacity", function () {
            // if(ja[data['nodes'][ii]['id']]==1)
            return 1
            // else return 0
          })
          .attr("fill", function () {
            comm = com[data[ii]['id']]
            // if(comm == 2||comm ==11||comm==13||comm==5 ){
              if (comm == 44) {
              return mcolor[0]
            }
            if (comm == 8) {
              return mcolor[6]
            }
            if (comm == 12) {
              return mcolor[10]
            }
            if (comm == 6) {
              return mcolor[8]
            }
            if (comm == 39) {
              return mcolor[2]
            }
            if (comm == 42) {
              return mcolor[12]
            } if (comm == 57) {
              return mcolor[4]
            }
            if (comm == 14) {
              return mcolor[5]
            }
            if (comm == 43) {
              return mcolor[7]
            }
            if (comm == 40) {
              return mcolor[11]
            }
            return 'grey'
            // }
            // else return 'grey'

          });
      }

    }
    function drawforce8(data, sam, com) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // console.log(sam)
      Sa = sam['nodes']
      ja = {}
      for (i in Sa) {
        // ja[Sa[i]]=1
        ja[Sa[i]['id']] = 1
      }
      // console.log(ja,sam)
      d = data['nodes']
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")

      for (jj = 0; jj < sam['edges'].length; jj++) {
        // data['edges']
        x1 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].source
          //  return x.id ==data['edges'][jj].source
          // return x.id ==sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['x']
        y1 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].source
          // return x.id == data['edges'][jj].source
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][0]
        })['y']
        x2 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['x']
        y2 = data['nodes'].find(function (x) {
          return x.id == sam['edges'][jj].target
          // return x.id == data['edges'][jj].target
          // return x.id == sam[sfnum]['rate-10'][0]['edges'][jj][1]
        })['y']

        g.append("line")
          .attr("x1", scalex(x1 - minx))
          .attr("y1", scaley(y1 - miny))
          .attr("x2", scalex(x2 - minx))
          .attr("y2", scaley(y2 - miny))
          .attr("class", "top")
          .attr("stroke-width", 0.3)
          .attr("stroke-opacity", function () {

            // if((ja[sam[sfnum]['rate-10'][0]['edges'][jj][0]]==1)&&(ja[sam[sfnum]['rate-10'][0]['edges'][jj][1]]==1))
            return 1
            // else return 0
          })
          .attr("stroke", function () {

            return "#bbb"
          })
      }
      coutli = []
      for (ii = 0; ii < data["nodes"].length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data['nodes'][ii]['x'] - minx))
          .attr("cy", scaley(data['nodes'][ii]['y'] - miny))
          .attr("r", 3)
          .attr("id", data['nodes'][ii]['id'])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          // .attr("stroke", function () {
          //     return "#bbb"
          // })
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#555"
          })
          .attr("opacity", function () {
            if (ja[data['nodes'][ii]['id']] == 1)
              return 1
            else return 0
          })
          .attr("fill", function () {
            comm = com[data['nodes'][ii]['id']]
            // if(comm == 2||comm ==11||comm==13||comm==5 ){
            if (comm == 44) {
              return mcolor[0]
            }
            if (comm == 8) {
              return mcolor[6]
            }
            if (comm == 12) {
              return mcolor[10]
            }
            if (comm == 6) {
              return mcolor[8]
            }
            if (comm == 39) {
              return mcolor[2]
            }
            if (comm == 42) {
              return mcolor[12]
            } if (comm == 57) {
              return mcolor[4]
            }
            if (comm == 14) {
              return mcolor[5]
            }
            if (comm == 43) {
              return mcolor[7]
            }
            if (comm == 40) {
              return mcolor[11]
            }
            return 'grey'
            // if (cc[data['nodes'][ii]['id']]['betweenness'] > 1.024) {
            // if (ja[data['nodes'][ii]['id']] == 1)
            //   coutli.push(data['nodes'][ii]['id'])
            // idt = data['nodes'][ii]['id']
            // idli = ['1532781', "235219", "4015461"]
            // if (idli.indexOf(idt + "") > -1)
            // return "red"
            // else
            // return "aqua"
            // }
            // else {
            return "#777"
            // }
          });
      }
      console.log(coutli)
    }
    function drawforce9(data, sam, com) {

      var marge = {
        top: 50,
        right: 50,
        bottom: 50,
        left: 50
      }
      // console.log(sam)
      Sa = sam['nodes']
      ja = {}
      for (i in Sa) {
        // ja[Sa[i]]=1
        ja[Sa[i]['id']] = 1
      }
      // console.log(ja,sam)
      d = data
      maxx = (Math.max.apply(Math, d.map(function (o) { return o.x })))
      minx = (Math.min.apply(Math, d.map(function (o) { return o.x })))
      maxy = (Math.max.apply(Math, d.map(function (o) { return o.y })))
      miny = (Math.min.apply(Math, d.map(function (o) { return o.y })))
      var width = document.getElementById('force').clientWidth
      var height = document.getElementById('force').clientHeight
      var scalex = d3.scaleLinear()
        .domain([0, maxx - minx])
        .range([marge.left, width - marge.right]);
      var scaley = d3.scaleLinear()
        .domain([0, maxy - miny])
        .range([marge.top, height - marge.bottom]);

      var svg = d3.select("#force").append('svg').attr('width', width).attr('height', height)
      var g = svg.append("g")


      for (ii = 0; ii < data.length; ii++) {
        g.append("circle")
          .attr("cx", scalex(data[ii]['x'] - minx))
          .attr("cy", scaley(data[ii]['y'] - miny))
          .attr("r", 3)
          .attr("id", data[ii]['id'])
          // .attr("id", d[i].tag + "," + d[i].com)
          .attr("class", "top")
          // .attr("stroke", function () {
          //     return "#bbb"
          // })
          .attr("stroke-width", 0.3)
          .attr("stroke", function () {
            return "#555"
          })
          .attr("opacity", function () {
            if (ja[data[ii]['id']] == 1)
              return 1
            else return 0
          })
          .attr("fill", function () {
            comm = com[data[ii]['id']]
            // if(comm == 2||comm ==11||comm==13||comm==5 ){
              if (comm == 44) {
              return mcolor[0]
            }
            if (comm == 8) {
              return mcolor[6]
            }
            if (comm == 12) {
              return mcolor[10]
            }
            if (comm == 6) {
              return mcolor[8]
            }
            if (comm == 39) {
              return mcolor[2]
            }
            if (comm == 42) {
              return mcolor[12]
            } if (comm == 57) {
              return mcolor[4]
            }
            if (comm == 14) {
              return mcolor[5]
            }
            if (comm == 43) {
              return mcolor[7]
            }
            if (comm == 40) {
              return mcolor[11]
            }
            return 'grey'
            // if (cc[data['nodes'][ii]['id']]['betweenness'] > 1.024) {
            // if (ja[data['nodes'][ii]['id']] == 1)
            //   coutli.push(data['nodes'][ii]['id'])
            // idt = data['nodes'][ii]['id']
            // idli = ['1532781', "235219", "4015461"]
            // if (idli.indexOf(idt + "") > -1)
            // return "red"
            // else
            // return "aqua"
            // }
            // else {
            return "#777"
            // }
          });
      }
      console.log(coutli)
    }

  </script>
  <!-- <script src="newcl.js"></script> -->
  <div id="showTree"></div>
</body>

</html>